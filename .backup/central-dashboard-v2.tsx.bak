/**
 * ARQUIVO: client/src/pages/central-dashboard-v2.tsx
 * PROP√ìSITO: Dashboard V2 - Layout do Prot√≥tipo Interativo COMPLETO
 * LAYOUT: Sidebar + Header KPIs + (Mapa 60% | Lista 40%) + Pain√©is + Modais
 */

import "@/styles/glass.css";
import { useQuery, useMutation } from "@tanstack/react-query";
import { queryClient, apiRequest } from "@/lib/queryClient";
import { useToast } from "@/hooks/use-toast";
import { useAuth } from "@/hooks/use-auth";
import type { Order, Motoboy, Client } from "@shared/schema";
import { useEffect, useState } from "react";
import { resolveWebSocketUrl } from "@/lib/utils";
import { 
  Package, Home, LogOut, Menu, Settings, X, Search, Filter,
  Bike, Store, DollarSign, User, Phone, MapPin, Clock, TrendingUp, TrendingDown,
  Users, UserCircle, MessageCircle, Calendar
} from "lucide-react";
import { MapOverlay } from "@/components/glass/MapOverlay";
import { ChatWidget } from "@/components/ChatWidget";
import { OperationalInsights } from "@/components/OperationalInsights";
import { Dialog, DialogContent, DialogHeader, DialogTitle } from "@/components/ui/dialog";
import { Input } from "@/components/ui/input";
import { Button } from "@/components/ui/button";

export default function CentralDashboardV2() {
  const { logout, token, user } = useAuth();
  const { toast } = useToast();
  const [ws, setWs] = useState<WebSocket | null>(null);
  const [activeView, setActiveView] = useState<string>('home');
  
  // ESTADOS DE PAIN√âIS E MODAIS
  const [openPanel, setOpenPanel] = useState<string | null>(null);
  const [openModal, setOpenModal] = useState<string | null>(null);
  const [selectedOrder, setSelectedOrder] = useState<Order | null>(null);
  const [selectedDriver, setSelectedDriver] = useState<Motoboy | null>(null);
  const [selectedClient, setSelectedClient] = useState<Client | null>(null);
  const [orderFilter, setOrderFilter] = useState<string>('all');
  const [driverSearch, setDriverSearch] = useState<string>('');
  const [clientSearch, setClientSearch] = useState<string>('');
  const [darkMode, setDarkMode] = useState<boolean>(true);
  const [financialTab, setFinancialTab] = useState<string>('overview');

  // ============ QUERIES ============
  const { data: orders = [], refetch: refetchOrders } = useQuery<Order[]>({ queryKey: ['/api/orders'] });
  const { data: motoboys = [], refetch: refetchMotoboys } = useQuery<Motoboy[]>({ queryKey: ['/api/motoboys'], refetchInterval: 5000 });
  const { data: clients = [] } = useQuery<Client[]>({ queryKey: ['/api/clients'], enabled: !!token });
  const { data: analyticsData } = useQuery<any>({ queryKey: ['/api/analytics/dashboard'], enabled: !!token, refetchInterval: 30000 });
  const { data: allClientSchedules = [] } = useQuery<any[]>({ queryKey: ['/api/schedules/all-clients'], enabled: !!token, refetchInterval: 60000 });
  const { data: allMotoboySchedules = [] } = useQuery<any[]>({ queryKey: ['/api/schedules/all-motoboys'], enabled: !!token, refetchInterval: 60000 });
  const { data: usersData = [] } = useQuery<any[]>({ queryKey: ['/api/users'], enabled: !!token });

  // ============ WEBSOCKET ============
  useEffect(() => {
    if (!token) return;
    const websocket = new WebSocket(resolveWebSocketUrl(token));
    websocket.onmessage = (event) => {
      const data = JSON.parse(event.data);
      if (data.type.includes('order')) refetchOrders();
      if (data.type.includes('driver')) refetchMotoboys();
    };
    setWs(websocket);
    return () => websocket.close();
  }, [token, refetchOrders, refetchMotoboys]);

  // ============ KPIs ============
  const totalOrders = orders.length;
  const activeDrivers = motoboys.filter((m: any) => m.online).length;
  const pendingOrders = orders.filter(o => o.status === 'pending').length;
  const inProgressOrders = orders.filter(o => o.status === 'in_progress').length;
  const deliveredOrders = orders.filter(o => o.status === 'delivered').length;
  
  // FILTROS
  const filteredOrders = orders.filter(order => {
    if (orderFilter === 'pending') return order.status === 'pending';
    if (orderFilter === 'in_progress') return order.status === 'in_progress';
    if (orderFilter === 'delivered') return order.status === 'delivered';
    return true;
  });

  const filteredDrivers = motoboys.filter(m => 
    m.name.toLowerCase().includes(driverSearch.toLowerCase())
  );

  const filteredClients = clients.filter(c => 
    c.name.toLowerCase().includes(clientSearch.toLowerCase())
  );

  // FUN√á√ïES DE CONTROLE
  const handleOpenPanel = (panel: string) => {
    setOpenPanel(panel);
    setOpenModal(null);
  };

  const handleOpenModal = (modal: string, data?: any) => {
    setOpenModal(modal);
    setOpenPanel(null);
    if (modal === 'order-detail' && data) setSelectedOrder(data);
    if (modal === 'driver-detail' && data) setSelectedDriver(data);
    if (modal === 'client-detail' && data) setSelectedClient(data);
  };

  const handleCloseAll = () => {
    setOpenPanel(null);
    setOpenModal(null);
  };

  // ============ LAYOUT DO PROT√ìTIPO ============
  return (
    <div className={`h-screen flex p-4 gap-4 overflow-hidden transition-colors ${darkMode ? 'bg-[#0f0f11]' : 'bg-gradient-to-br from-gray-100 to-gray-200'}`}>
      
      {/* SIDEBAR (20 */}
      <aside className="w-20 glass-panel rounded-2xl flex flex-col items-center py-6 gap-8">
        <div className="w-12 h-12 bg-gradient-to-br from-blue-600 to-indigo-600 rounded-xl flex items-center justify-center shadow-lg">
          <Menu className="text-white" size={24} />
        </div>

        <nav className="flex flex-col gap-4 w-full px-3">
          <button onClick={() => handleOpenPanel('home')} className={`w-full aspect-square rounded-xl flex items-center justify-center ${activeView === 'home' ? 'bg-blue-600 text-white' : 'text-gray-400 hover:bg-white/10'} transition`}>
            <Home size={20} />
          </button>
          <button onClick={() => handleOpenPanel('orders')} className={`w-full aspect-square rounded-xl flex items-center justify-center ${activeView === 'orders' ? 'bg-blue-600 text-white' : 'text-gray-400 hover:bg-white/10'} transition`}>
            <Package size={20} />
          </button>
          <button onClick={() => handleOpenPanel('drivers')} className={`w-full aspect-square rounded-xl flex items-center justify-center ${activeView === 'drivers' ? 'bg-blue-600 text-white' : 'text-gray-400 hover:bg-white/10'} transition`}>
            <Bike size={20} />
          </button>
          <button onClick={() => handleOpenPanel('clients')} className={`w-full aspect-square rounded-xl flex items-center justify-center ${activeView === 'clients' ? 'bg-blue-600 text-white' : 'text-gray-400 hover:bg-white/10'} transition`}>
            <Store size={20} />
          </button>
          <button onClick={() => handleOpenPanel('financial')} className={`w-full aspect-square rounded-xl flex items-center justify-center ${activeView === 'financial' ? 'bg-blue-600 text-white' : 'text-gray-400 hover:bg-white/10'} transition`}>
            <DollarSign size={20} />
          </button>
        </nav>

        <div className="mt-auto flex flex-col gap-4">
          <button onClick={() => handleOpenModal('settings')} className="w-10 h-10 rounded-full bg-white/5 flex items-center justify-center text-gray-400 hover:text-white transition">
            <Settings size={18} />
          </button>
          <button onClick={logout} className="w-10 h-10 rounded-full bg-red-500/10 flex items-center justify-center text-red-400 hover:bg-red-500/20 transition">
            <LogOut size={18} />
          </button>
        </div>
      </aside>

      {/* MAIN CONTENT */}
      <main className="flex-1 flex flex-col gap-4 min-w-0">
        
        {/* HEADER COM KPIs */}
        <header className="flex justify-between items-end h-20 pb-2">
          <div>
            <h1 className="text-3xl font-bold text-white">Dashboard Interativo</h1>
            <p className="text-gray-400 text-sm mt-1">Clique nos elementos para interagir</p>
          </div>
          
          <div className="flex gap-4">
            <div onClick={() => handleOpenPanel('orders')} className="glass-panel px-5 py-3 rounded-xl flex items-center gap-4 cursor-pointer hover:scale-105 transition border border-blue-500/40 bg-black/40">
              <div className="w-12 h-12 rounded-xl bg-blue-600 flex items-center justify-center text-white shadow-xl">
                <Package size={24} />
              </div>
              <div>
                <div className="text-xs text-gray-300 uppercase font-bold tracking-wide">Pedidos</div>
                <div className="text-3xl font-black text-white drop-shadow-[0_2px_10px_rgba(0,0,0,0.9)]">{totalOrders}</div>
              </div>
            </div>
            
            <div onClick={() => handleOpenPanel('drivers')} className="glass-panel px-5 py-3 rounded-xl flex items-center gap-4 cursor-pointer hover:scale-105 transition border border-green-500/40 bg-black/40">
              <div className="w-12 h-12 rounded-xl bg-green-600 flex items-center justify-center text-white shadow-xl">
                <Bike size={24} />
              </div>
              <div>
                <div className="text-xs text-gray-300 uppercase font-bold tracking-wide">Motoboys</div>
                <div className="text-3xl font-black text-white drop-shadow-[0_2px_10px_rgba(0,0,0,0.9)]">{activeDrivers}/{motoboys.length}</div>
              </div>
            </div>
            
            <div onClick={() => handleOpenPanel('clients')} className="glass-panel px-5 py-3 rounded-xl flex items-center gap-4 cursor-pointer hover:scale-105 transition border border-yellow-500/40 bg-black/40">
              <div className="w-12 h-12 rounded-xl bg-yellow-600 flex items-center justify-center text-white shadow-xl">
                <Store size={24} />
              </div>
              <div>
                <div className="text-xs text-gray-300 uppercase font-bold tracking-wide">Clientes</div>
                <div className="text-3xl font-black text-white drop-shadow-[0_2px_10px_rgba(0,0,0,0.9)]">{clients.length}</div>
              </div>
            </div>
            
            <div onClick={() => handleOpenPanel('financial')} className="glass-panel px-5 py-3 rounded-xl flex items-center gap-4 cursor-pointer hover:scale-105 transition border border-purple-500/40 bg-black/40">
              <div className="w-12 h-12 rounded-xl bg-purple-600 flex items-center justify-center text-white shadow-xl">
                <DollarSign size={24} />
              </div>
              <div>
                <div className="text-xs text-gray-300 uppercase font-bold tracking-wide">Financeiro</div>
                <div className="text-3xl font-black text-white drop-shadow-[0_2px_10px_rgba(0,0,0,0.9)]">
                  R$ {analyticsData ? (analyticsData.todayRevenue / 1000).toFixed(1) : '0'}k
                </div>
              </div>
            </div>
          </div>
        </header>

        {/* CONTENT GRID: MAP (60%) + LIST (40%) */}
        <div className="flex-1 flex gap-4 min-h-0">
          
          {/* MAP SECTION */}
          <section className="flex-[3] glass-panel rounded-2xl relative overflow-hidden">
            <MapOverlay clients={clients} motoboys={motoboys} orders={orders} />
          </section>

          {/* ORDERS LIST */}
          <section className="flex-[2] flex flex-col gap-4 min-w-[350px]">
            <div className="flex justify-between items-center px-1">
              <h2 className="text-lg font-bold text-white">Pedidos Recentes</h2>
              <button className="text-xs text-blue-400 font-medium hover:text-blue-300">Ver Todos</button>
            </div>

            <div className="flex-1 overflow-y-auto flex flex-col gap-3 pr-1">
              {orders.slice(0, 10).map((order) => (
                <div 
                  key={order.id} 
                  onClick={() => handleOpenModal('order-detail', order)}
                  className={`glass-panel p-4 rounded-xl border-l-4 ${
                  order.status === 'pending' ? 'border-blue-500' :
                  order.status === 'in_progress' ? 'border-yellow-500' :
                  'border-green-500'
                } hover:bg-white/10 cursor-pointer transition`}>
                  <div className="flex justify-between items-start mb-2">
                    <div className="flex items-center gap-3">
                      <div className={`w-10 h-10 rounded-lg flex items-center justify-center ${
                        order.status === 'pending' ? 'bg-blue-500/10 text-blue-400' :
                        order.status === 'in_progress' ? 'bg-yellow-500/10 text-yellow-400' :
                        'bg-green-500/10 text-green-400'
                      }`}>
                        <Package size={20} />
                      </div>
                      <div>
                        <div className="font-bold text-sm text-white">{order.clientName}</div>
                        <div className="text-xs text-gray-400">#{order.id.slice(0, 8)} ‚Ä¢ {order.entregaBairro}</div>
                      </div>
                    </div>
                    <span className={`text-[10px] px-2 py-1 rounded border ${
                      order.status === 'pending' ? 'bg-blue-500/20 text-blue-300 border-blue-500/30' :
                      order.status === 'in_progress' ? 'bg-yellow-500/20 text-yellow-300 border-yellow-500/30' :
                      'bg-green-500/20 text-green-300 border-green-500/30'
                    }`}>
                      {order.status === 'pending' && 'NOVO'}
                      {order.status === 'in_progress' && 'EM ROTA'}
                      {order.status === 'delivered' && 'ENTREGUE'}
                    </span>
                  </div>
                  <div className="flex justify-between items-center mt-3 pt-3 border-t border-white/5">
                    <span className="text-xs text-gray-400">{order.motoboyName || 'Aguardando aceite'}</span>
                    <span className="font-bold text-sm text-white">R$ {parseFloat(order.valor).toFixed(2)}</span>
                  </div>
                </div>
              ))}
            </div>

            <button onClick={() => handleOpenModal('new-order')} className="w-full py-4 rounded-xl bg-blue-600 hover:bg-blue-500 text-white font-bold shadow-lg transition">
              <Package className="inline mr-2" size={16} />
              Novo Pedido
            </button>
          </section>
        </div>
      </main>

      {/* ==================== PAIN√âIS LATERAIS ==================== */}
      
      {/* PAINEL - PEDIDOS */}
      {openPanel === 'orders' && (
        <div className="fixed right-0 top-0 h-full w-[450px] glass-panel border-l border-white/10 z-50 overflow-y-auto animate-slide-in">
          <div className="p-6 border-b border-white/10 flex items-center justify-between sticky top-0 glass-panel">
            <h2 className="text-2xl font-bold">Pedidos</h2>
            <button onClick={handleCloseAll} className="hover:bg-white/10 p-2 rounded-lg transition">
              <X size={24} />
            </button>
          </div>
          
          <div className="p-6">
            <div className="flex gap-2 mb-6">
              <button 
                onClick={() => setOrderFilter('all')}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${orderFilter === 'all' ? 'bg-blue-600 text-white' : 'bg-white/5 text-gray-400'}`}
              >
                Todos ({totalOrders})
              </button>
              <button 
                onClick={() => setOrderFilter('pending')}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${orderFilter === 'pending' ? 'bg-blue-600 text-white' : 'bg-white/5 text-gray-400'}`}
              >
                Novos ({pendingOrders})
              </button>
              <button 
                onClick={() => setOrderFilter('in_progress')}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${orderFilter === 'in_progress' ? 'bg-yellow-600 text-white' : 'bg-white/5 text-gray-400'}`}
              >
                Em Rota ({inProgressOrders})
              </button>
              <button 
                onClick={() => setOrderFilter('delivered')}
                className={`px-4 py-2 rounded-lg text-sm font-medium ${orderFilter === 'delivered' ? 'bg-green-600 text-white' : 'bg-white/5 text-gray-400'}`}
              >
                Entregues ({deliveredOrders})
              </button>
            </div>

            <div className="space-y-3">
              {filteredOrders.map(order => (
                <div 
                  key={order.id}
                  onClick={() => handleOpenModal('order-detail', order)}
                  className="glass-panel p-4 rounded-xl cursor-pointer hover:bg-white/10 transition border-l-4 border-blue-500"
                >
                  <div className="flex items-center justify-between mb-3">
                    <span className="font-bold text-white">#{order.id.slice(0, 8)}</span>
                    <span className={`text-xs px-3 py-1 rounded-full ${
                      order.status === 'pending' ? 'bg-blue-500/20 text-blue-300' :
                      order.status === 'in_progress' ? 'bg-yellow-500/20 text-yellow-300' :
                      'bg-green-500/20 text-green-300'
                    }`}>
                      {order.status.toUpperCase()}
                    </span>
                  </div>
                  <div className="text-sm font-medium mb-2">{order.clientName}</div>
                  <div className="text-xs text-gray-400 mb-1">üìç {order.coletaBairro}</div>
                  <div className="text-xs text-gray-400 mb-3">üèÅ {order.entregaBairro}</div>
                  <div className="flex items-center justify-between pt-3 border-t border-white/5">
                    <span className="text-green-400 font-bold">R$ {parseFloat(order.valor).toFixed(2)}</span>
                    {order.motoboyName && <span className="text-xs text-gray-500">Motoboy: {order.motoboyName}</span>}
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* PAINEL - MOTOBOYS */}
      {openPanel === 'drivers' && (
        <div className="fixed right-0 top-0 h-full w-[450px] glass-panel border-l border-white/10 z-50 overflow-y-auto animate-slide-in">
          <div className="p-6 border-b border-white/10 flex items-center justify-between sticky top-0 glass-panel">
            <h2 className="text-2xl font-bold">Motoboys</h2>
            <button onClick={handleCloseAll} className="hover:bg-white/10 p-2 rounded-lg transition">
              <X size={24} />
            </button>
          </div>
          
          <div className="p-6">
            <div className="mb-6 relative">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
              <input 
                type="text"
                placeholder="Buscar motoboy..."
                value={driverSearch}
                onChange={(e) => setDriverSearch(e.target.value)}
                className="w-full pl-12 pr-4 py-3 glass-panel rounded-xl text-sm focus:ring-2 ring-blue-500 outline-none"
              />
            </div>

            <div className="space-y-3">
              {filteredDrivers.map(motoboy => (
                <div 
                  key={motoboy.id}
                  onClick={() => handleOpenModal('driver-detail', motoboy)}
                  className="glass-panel p-4 rounded-xl cursor-pointer hover:bg-white/10 transition"
                >
                  <div className="flex items-center gap-4">
                    <div className={`w-14 h-14 rounded-full flex items-center justify-center ${
                      motoboy.online ? 'bg-green-500/20 ring-2 ring-green-500' : 'bg-gray-500/20'
                    }`}>
                      <Bike className="w-7 h-7" />
                    </div>
                    <div className="flex-1">
                      <div className="flex items-center gap-2 mb-1">
                        <span className="font-bold text-white">{motoboy.name}</span>
                        {motoboy.online && <span className="w-2 h-2 rounded-full bg-green-400 animate-pulse"></span>}
                      </div>
                      <div className="text-xs text-gray-400 mb-1">
                        {motoboy.phone || 'Sem telefone'}
                      </div>
                      <div className="text-xs">
                        {motoboy.online ? 
                          <span className="text-green-400 font-medium">üü¢ Online</span> : 
                          <span className="text-gray-500">‚ö´ Offline</span>
                        }
                      </div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* PAINEL - CLIENTES */}
      {openPanel === 'clients' && (
        <div className="fixed right-0 top-0 h-full w-[450px] glass-panel border-l border-white/10 z-50 overflow-y-auto animate-slide-in">
          <div className="p-6 border-b border-white/10 flex items-center justify-between sticky top-0 glass-panel">
            <h2 className="text-2xl font-bold">Clientes</h2>
            <button onClick={handleCloseAll} className="hover:bg-white/10 p-2 rounded-lg transition">
              <X size={24} />
            </button>
          </div>
          
          <div className="p-6">
            <div className="mb-6 relative">
              <Search className="absolute left-4 top-1/2 -translate-y-1/2 w-5 h-5 text-gray-400" />
              <input 
                type="text"
                placeholder="Buscar cliente..."
                value={clientSearch}
                onChange={(e) => setClientSearch(e.target.value)}
                className="w-full pl-12 pr-4 py-3 glass-panel rounded-xl text-sm focus:ring-2 ring-blue-500 outline-none"
              />
            </div>

            <div className="space-y-3">
              {filteredClients.map(client => (
                <div 
                  key={client.id}
                  onClick={() => handleOpenModal('client-detail', client)}
                  className="glass-panel p-4 rounded-xl cursor-pointer hover:bg-white/10 transition"
                >
                  <div className="flex items-center gap-4">
                    <div className="w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center">
                      <Store className="w-7 h-7 text-blue-400" />
                    </div>
                    <div className="flex-1">
                      <div className="font-bold text-white mb-1">{client.name}</div>
                      <div className="text-xs text-gray-400 mb-1">{client.phone}</div>
                      <div className="text-xs text-gray-500">{client.rua}, {client.numero} - {client.bairro}</div>
                    </div>
                  </div>
                </div>
              ))}
            </div>
          </div>
        </div>
      )}

      {/* PAINEL - FINANCEIRO COMPLETO */}
      {openPanel === 'financial' && (
        <div className="fixed inset-0 z-50 bg-[#0f0f11] animate-slide-in flex flex-col">
          {/* Header */}
          <div className="h-20 border-b border-white/10 flex justify-between items-center px-8 bg-[#141416]">
            <div className="flex items-center gap-4">
              <button onClick={handleCloseAll} className="w-10 h-10 rounded-full bg-white/5 hover:bg-white/10 flex items-center justify-center">
                <X size={20} />
              </button>
              <div>
                <h1 className="text-2xl font-bold">Central Financeira</h1>
                <p className="text-gray-400 text-sm">Gest√£o completa de receitas, repasses e lucros</p>
              </div>
            </div>
            <div className="flex gap-3">
              <div className="bg-black/30 border border-white/10 rounded-lg px-3 py-2 flex items-center gap-2">
                <Calendar size={16} className="text-gray-400" />
                <span className="text-sm">Hoje, {new Date().toLocaleDateString('pt-BR', { day: '2-digit', month: 'short' })}</span>
              </div>
              <button className="px-4 py-2 bg-blue-600 hover:bg-blue-500 text-white rounded-lg text-sm font-bold flex items-center gap-2">
                <TrendingDown size={16} /> Exportar Relat√≥rio
              </button>
            </div>
          </div>

          {/* Main Content com Sidebar */}
          <div className="flex-1 overflow-hidden flex">
            {/* Sidebar Navigation */}
            <div className="w-64 bg-[#141416] border-r border-white/10 p-4 flex flex-col gap-2">
              <button 
                onClick={() => setFinancialTab('overview')}
                className={`p-3 rounded-xl text-left flex items-center gap-3 font-bold transition ${
                  financialTab === 'overview' 
                    ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' 
                    : 'hover:bg-white/5 text-gray-400 hover:text-white font-medium'
                }`}
              >
                <TrendingUp size={20} /> Vis√£o Geral
              </button>
              <button 
                onClick={() => setFinancialTab('by-client')}
                className={`p-3 rounded-xl text-left flex items-center gap-3 font-bold transition ${
                  financialTab === 'by-client' 
                    ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' 
                    : 'hover:bg-white/5 text-gray-400 hover:text-white font-medium'
                }`}
              >
                <Store size={20} /> Por Cliente
              </button>
              <button 
                onClick={() => setFinancialTab('by-motoboy')}
                className={`p-3 rounded-xl text-left flex items-center gap-3 font-bold transition ${
                  financialTab === 'by-motoboy' 
                    ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' 
                    : 'hover:bg-white/5 text-gray-400 hover:text-white font-medium'
                }`}
              >
                <Bike size={20} /> Por Motoboy
              </button>
              <button 
                onClick={() => setFinancialTab('payables')}
                className={`p-3 rounded-xl text-left flex items-center gap-3 font-bold transition ${
                  financialTab === 'payables' 
                    ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' 
                    : 'hover:bg-white/5 text-gray-400 hover:text-white font-medium'
                }`}
              >
                <DollarSign size={20} /> Contas a Pagar
              </button>
              <button 
                onClick={() => setFinancialTab('receivables')}
                className={`p-3 rounded-xl text-left flex items-center gap-3 font-bold transition ${
                  financialTab === 'receivables' 
                    ? 'bg-blue-600/20 text-blue-400 border border-blue-500/30' 
                    : 'hover:bg-white/5 text-gray-400 hover:text-white font-medium'
                }`}
              >
                <TrendingUp size={20} /> Contas a Receber
              </button>
            </div>

            {/* Dashboard Content */}
            <div className="flex-1 overflow-y-auto p-8">
            
            {/* VIS√ÉO GERAL */}
            {financialTab === 'overview' && (
              <>
            {/* KPI Cards */}
            <div className="grid grid-cols-4 gap-6 mb-8">
              <div className="glass-panel p-6 rounded-2xl border-t-4 border-indigo-500">
                <div className="flex justify-between items-start mb-4">
                  <div className="w-12 h-12 rounded-xl bg-indigo-500/20 flex items-center justify-center">
                    <Package className="text-indigo-400" size={24} />
                  </div>
                  <span className="text-xs bg-indigo-500/20 text-indigo-400 px-2 py-1 rounded">+12%</span>
                </div>
                <div className="text-gray-400 text-xs uppercase font-bold tracking-wider">Volume Total (GMV)</div>
                <div className="text-4xl font-black text-white mt-2 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]">R$ {(orders.reduce((sum, o) => sum + parseFloat(o.valor), 0)).toLocaleString('pt-BR', { minimumFractionDigits: 2 })}</div>
                <div className="text-xs text-gray-400 mt-2 font-medium">Soma de Pedidos + Taxas</div>
              </div>

              <div className="glass-panel p-6 rounded-2xl border-t-4 border-blue-500">
                <div className="flex justify-between items-start mb-4">
                  <div className="w-12 h-12 rounded-xl bg-blue-500/20 flex items-center justify-center">
                    <DollarSign className="text-blue-400" size={24} />
                  </div>
                  <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">+15%</span>
                </div>
                <div className="text-gray-400 text-xs uppercase font-bold tracking-wider">Receita de Taxas</div>
                <div className="text-4xl font-black text-white mt-2 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]">R$ 3.240,50</div>
                <div className="text-xs text-gray-400 mt-2 font-medium">A Receber das Empresas</div>
              </div>

              <div className="glass-panel p-6 rounded-2xl border-t-4 border-red-500">
                <div className="flex justify-between items-start mb-4">
                  <div className="w-12 h-12 rounded-xl bg-red-500/20 flex items-center justify-center">
                    <Bike className="text-red-400" size={24} />
                  </div>
                  <span className="text-xs bg-red-500/20 text-red-400 px-2 py-1 rounded">+8%</span>
                </div>
                <div className="text-gray-400 text-xs uppercase font-bold tracking-wider">Repasse Motoboys</div>
                <div className="text-4xl font-black text-white mt-2 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]">R$ 2.150,00</div>
                <div className="text-xs text-gray-400 mt-2 font-medium">Custo Operacional</div>
              </div>

              <div className="glass-panel p-6 rounded-2xl border-t-4 border-green-500">
                <div className="flex justify-between items-start mb-4">
                  <div className="w-12 h-12 rounded-xl bg-green-500/20 flex items-center justify-center">
                    <TrendingUp className="text-green-400" size={24} />
                  </div>
                  <span className="text-xs bg-green-500/20 text-green-400 px-2 py-1 rounded">+22%</span>
                </div>
                <div className="text-gray-400 text-xs uppercase font-bold tracking-wider">Lucro Guriri</div>
                <div className="text-4xl font-black text-white mt-2 drop-shadow-[0_2px_8px_rgba(0,0,0,0.8)]">R$ 1.090,50</div>
                <div className="text-xs text-gray-400 mt-2 font-medium">Taxas - Repasses</div>
              </div>
            </div>

            {/* Charts & Tables Grid */}
            <div className="grid grid-cols-3 gap-6 mb-6">
              {/* Gr√°fico de Desempenho por Hora */}
              <div className="col-span-2 glass-panel p-6 rounded-2xl">
                <div className="flex justify-between items-center mb-6">
                  <h3 className="font-bold text-lg">Desempenho por Hora</h3>
                  <div className="flex gap-2">
                    <span className="flex items-center gap-1 text-xs text-gray-400">
                      <div className="w-2 h-2 bg-blue-500 rounded-full"></div> Receita
                    </span>
                    <span className="flex items-center gap-1 text-xs text-gray-400">
                      <div className="w-2 h-2 bg-red-500 rounded-full"></div> Custo
                    </span>
                  </div>
                </div>
                <div className="h-64 flex items-end justify-between gap-2 px-2">
                  {[
                    { time: '10h', height: 20 },
                    { time: '11h', height: 40 },
                    { time: '12h', height: 90 },
                    { time: '13h', height: 70 },
                    { time: '14h', height: 30 },
                    { time: '18h', height: 50 },
                    { time: '19h', height: 85 },
                    { time: '20h', height: 80 }
                  ].map((bar, i) => (
                    <div key={i} className="w-full bg-gray-800 rounded-t-lg relative group" style={{ height: `${bar.height}%` }}>
                      <div className="absolute bottom-0 w-full bg-blue-600/50 h-[80%] rounded-t-lg"></div>
                      <div className="absolute bottom-0 w-full bg-red-600/50 h-[60%] rounded-t-lg"></div>
                      <div className="absolute -bottom-6 left-1/2 -translate-x-1/2 text-[10px] text-gray-500">{bar.time}</div>
                    </div>
                  ))}
                </div>
              </div>

              {/* Top Clientes */}
              <div className="glass-panel p-6 rounded-2xl flex flex-col">
                <h3 className="font-bold text-lg mb-4">Top Clientes (Receita)</h3>
                <div className="flex-1 overflow-y-auto space-y-3">
                  {[
                    { name: 'Burger King', icon: 'BK', bg: 'bg-blue-600', orders: 15, revenue: 450 },
                    { name: 'Pizza Hut', icon: 'PH', bg: 'bg-yellow-600', orders: 12, revenue: 380.50 },
                    { name: "McDonald's", icon: 'MC', bg: 'bg-red-600', orders: 8, revenue: 210 }
                  ].map((client, i) => (
                    <div key={i} className="flex items-center justify-between p-3 bg-white/5 rounded-xl border border-white/10">
                      <div className="flex items-center gap-3">
                        <div className={`w-8 h-8 rounded ${client.bg} flex items-center justify-center text-white font-bold text-xs`}>
                          {client.icon}
                        </div>
                        <div>
                          <div className="text-sm font-bold">{client.name}</div>
                          <div className="text-[10px] text-gray-400">{client.orders} pedidos</div>
                        </div>
                      </div>
                      <div className="text-right">
                        <div className="text-sm font-bold text-green-400">R$ {client.revenue.toFixed(2)}</div>
                        <div className="text-[10px] text-gray-500">A Receber</div>
                      </div>
                    </div>
                  ))}
                </div>
                <button className="mt-4 w-full py-2 bg-white/5 hover:bg-white/10 rounded-lg text-xs font-bold text-gray-400 hover:text-white transition">
                  Ver Todos
                </button>
              </div>
            </div>

            {/* Tabela de Transa√ß√µes Detalhada */}
            <div className="glass-panel p-6 rounded-2xl">
              <div className="flex justify-between items-center mb-4">
                <h3 className="font-bold text-lg">üí∞ Transa√ß√µes Recentes (Tabela Fixa de Pre√ßos)</h3>
                <div className="flex gap-2 text-xs">
                  <span className="px-3 py-1 bg-blue-500/20 text-blue-400 rounded border border-blue-500/30">
                    Tabela A (Mensalista)
                  </span>
                  <span className="px-3 py-1 bg-purple-500/20 text-purple-400 rounded border border-purple-500/30">
                    Tabela B (Avulso)
                  </span>
                </div>
              </div>
              <div className="overflow-x-auto">
                <table className="w-full text-left text-sm">
                  <thead className="border-b border-white/10 text-xs uppercase text-gray-400">
                    <tr>
                      <th className="py-3 pl-2">ID</th>
                      <th className="py-3">Hora</th>
                      <th className="py-3">Cliente</th>
                      <th className="py-3">Tipo</th>
                      <th className="py-3">Motoboy</th>
                      <th className="py-3 text-right">Valor Pedido</th>
                      <th className="py-3 text-right">Taxa Entrega</th>
                      <th className="py-3 text-right">Total Geral</th>
                      <th className="py-3 text-right">Repasse Motoboy</th>
                      <th className="py-3 text-right">Lucro Guriri</th>
                      <th className="py-3 text-center">Status</th>
                    </tr>
                  </thead>
                  <tbody className="text-gray-400">
                    {orders.slice(0, 10).map((order, idx) => {
                      const valorPedido = parseFloat(order.valor || '0');
                      const taxaEntrega = idx % 2 === 0 ? 15 : 10;
                      const totalGeral = valorPedido + taxaEntrega;
                      const repasseMotoboy = idx % 2 === 0 ? 10 : 7;
                      const lucroGuriri = taxaEntrega - repasseMotoboy;
                      const tipoCliente = idx % 3 === 0 ? 'MENSAL' : 'AVULSO';
                      
                      return (
                        <tr key={order.id} className="border-b border-white/5 hover:bg-white/5 transition">
                          <td className="py-3 pl-2 font-bold text-white">#{order.id.slice(0, 4)}</td>
                          <td>{new Date(order.createdAt).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</td>
                          <td>{order.clientName}</td>
                          <td>
                            <span className={`text-[10px] px-2 py-1 rounded ${
                              tipoCliente === 'MENSAL' ? 'bg-blue-500/20 text-blue-400' : 'bg-purple-500/20 text-purple-400'
                            }`}>
                              {tipoCliente}
                            </span>
                          </td>
                          <td>{order.motoboyName || 'Sem motoboy'}</td>
                          <td className="text-right text-gray-400">R$ {valorPedido.toFixed(2)}</td>
                          <td className="text-right text-white font-bold">R$ {taxaEntrega.toFixed(2)}</td>
                          <td className="text-right text-gray-400">R$ {totalGeral.toFixed(2)}</td>
                          <td className="text-right text-red-400">- R$ {repasseMotoboy.toFixed(2)}</td>
                          <td className="text-right text-green-400">+ R$ {lucroGuriri.toFixed(2)}</td>
                          <td className="text-center">
                            <span className={`px-2 py-1 rounded text-[10px] font-bold ${
                              order.status === 'delivered' ? 'bg-green-500/20 text-green-400' : 'bg-yellow-500/20 text-yellow-400'
                            }`}>
                              {order.status === 'delivered' ? 'PAGO' : 'PENDENTE'}
                            </span>
                          </td>
                        </tr>
                      );
                    })}
                  </tbody>
                </table>
              </div>

              {/* Legendas */}
              <div className="mt-6 p-4 bg-blue-500/10 border border-blue-500/30 rounded-lg">
                <h4 className="font-bold text-sm mb-3 text-blue-400">üìã Como funciona a Tabela Fixa:</h4>
                <div className="grid grid-cols-2 gap-4 text-xs text-gray-300">
                  <div>
                    <div className="font-bold text-blue-400 mb-1">TABELA A (Mensalista)</div>
                    <ul className="space-y-1 ml-4">
                      <li>‚Ä¢ Cliente paga mensalidade</li>
                      <li>‚Ä¢ Taxa fixa por dist√¢ncia:</li>
                      <li className="ml-4">- At√© 3km: R$ 7,00</li>
                      <li className="ml-4">- 3-6km: R$ 10,00</li>
                      <li className="ml-4">- Acima 6km: R$ 15,00</li>
                      <li>‚Ä¢ Repasse ao motoboy: 66% da taxa</li>
                    </ul>
                  </div>
                  <div>
                    <div className="font-bold text-purple-400 mb-1">TABELA B (Avulso)</div>
                    <ul className="space-y-1 ml-4">
                      <li>‚Ä¢ Sem mensalidade</li>
                      <li>‚Ä¢ Taxa fixa maior:</li>
                      <li className="ml-4">- At√© 3km: R$ 8,00</li>
                      <li className="ml-4">- 3-6km: R$ 10,00</li>
                      <li className="ml-4">- Acima 6km: R$ 15,00</li>
                      <li>‚Ä¢ Repasse ao motoboy: 70% da taxa</li>
                    </ul>
                  </div>
                </div>
              </div>
            </div>
            </>
            )}

            {/* POR CLIENTE */}
            {financialTab === 'by-client' && (
              <>
                <h2 className="text-2xl font-bold mb-6">üìä Relat√≥rio por Cliente</h2>
                <div className="grid gap-4">
                  {clients.slice(0, 10).map((client) => {
                    const clientOrders = orders.filter(o => o.clientId === client.id);
                    const totalPedidos = clientOrders.length;
                    const totalReceita = clientOrders.reduce((sum, o) => sum + parseFloat(o.valor || '0'), 0);
                    const totalTaxas = totalPedidos * 12.5; // M√©dia de taxa
                    
                    return (
                      <div key={client.id} className="glass-panel p-6 rounded-xl hover:bg-white/5 transition cursor-pointer">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <div className="w-14 h-14 rounded-full bg-blue-500/20 flex items-center justify-center">
                              <Store className="text-blue-400" size={28} />
                            </div>
                            <div>
                              <h3 className="text-lg font-bold">{client.name}</h3>
                              <p className="text-sm text-gray-400">{client.phone}</p>
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-xs text-gray-400 mb-1">RECEITA TOTAL</div>
                            <div className="text-2xl font-bold text-green-400">R$ {totalReceita.toFixed(2)}</div>
                            <div className="text-xs text-gray-500 mt-1">{totalPedidos} pedidos ‚Ä¢ R$ {totalTaxas.toFixed(2)} em taxas</div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            )}

            {/* POR MOTOBOY */}
            {financialTab === 'by-motoboy' && (
              <>
                <h2 className="text-2xl font-bold mb-6">üèçÔ∏è Relat√≥rio por Motoboy</h2>
                <div className="grid gap-4">
                  {motoboys.slice(0, 10).map((motoboy) => {
                    const motoboyOrders = orders.filter(o => o.motoboyId === motoboy.id);
                    const totalEntregas = motoboyOrders.length;
                    const totalRepasse = totalEntregas * 8.5; // M√©dia de repasse
                    const totalKm = totalEntregas * 3.2; // M√©dia de km
                    
                    return (
                      <div key={motoboy.id} className="glass-panel p-6 rounded-xl hover:bg-white/5 transition cursor-pointer">
                        <div className="flex items-center justify-between">
                          <div className="flex items-center gap-4">
                            <div className="w-14 h-14 rounded-full bg-purple-500/20 flex items-center justify-center relative">
                              <Bike className="text-purple-400" size={28} />
                              {motoboy.online && (
                                <div className="absolute -top-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-[#0f0f11]"></div>
                              )}
                            </div>
                            <div>
                              <h3 className="text-lg font-bold">{motoboy.name}</h3>
                              <p className="text-sm text-gray-400">{motoboy.placa || 'Sem placa'} ‚Ä¢ {motoboy.phone || 'Sem telefone'}</p>
                            </div>
                          </div>
                          <div className="text-right">
                            <div className="text-xs text-gray-400 mb-1">REPASSE TOTAL</div>
                            <div className="text-2xl font-bold text-green-400">R$ {totalRepasse.toFixed(2)}</div>
                            <div className="text-xs text-gray-500 mt-1">{totalEntregas} entregas ‚Ä¢ {totalKm.toFixed(1)} km rodados</div>
                          </div>
                        </div>
                      </div>
                    );
                  })}
                </div>
              </>
            )}

            {/* CONTAS A PAGAR */}
            {financialTab === 'payables' && (
              <>
                <h2 className="text-2xl font-bold mb-6">üí∏ Contas a Pagar</h2>
                <div className="glass-panel p-6 rounded-xl mb-6">
                  <div className="grid grid-cols-3 gap-6 mb-6">
                    <div className="text-center p-4 bg-red-500/10 rounded-xl border border-red-500/30">
                      <div className="text-sm text-gray-400 mb-1">VENCIDAS</div>
                      <div className="text-3xl font-bold text-red-400">R$ 450,00</div>
                      <div className="text-xs text-gray-500 mt-1">3 contas</div>
                    </div>
                    <div className="text-center p-4 bg-yellow-500/10 rounded-xl border border-yellow-500/30">
                      <div className="text-sm text-gray-400 mb-1">VENCENDO HOJE</div>
                      <div className="text-3xl font-bold text-yellow-400">R$ 1.250,00</div>
                      <div className="text-xs text-gray-500 mt-1">5 contas</div>
                    </div>
                    <div className="text-center p-4 bg-blue-500/10 rounded-xl border border-blue-500/30">
                      <div className="text-sm text-gray-400 mb-1">A VENCER</div>
                      <div className="text-3xl font-bold text-blue-400">R$ 3.800,00</div>
                      <div className="text-xs text-gray-500 mt-1">12 contas</div>
                    </div>
                  </div>
                </div>

                <div className="glass-panel p-6 rounded-xl">
                  <table className="w-full text-sm">
                    <thead className="border-b border-white/10 text-xs uppercase text-gray-400">
                      <tr>
                        <th className="py-3 text-left">Descri√ß√£o</th>
                        <th className="py-3 text-left">Categoria</th>
                        <th className="py-3 text-left">Vencimento</th>
                        <th className="py-3 text-right">Valor</th>
                        <th className="py-3 text-center">Status</th>
                        <th className="py-3 text-center">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      {[
                        { desc: 'Repasse Motoboys - Semana 46', cat: 'Motoboys', venc: '2025-11-22', valor: 2150, status: 'vencendo' },
                        { desc: 'Aluguel Escrit√≥rio', cat: 'Fixo', venc: '2025-11-25', valor: 1500, status: 'aberto' },
                        { desc: 'Internet + Telefone', cat: 'Fixo', venc: '2025-11-28', valor: 350, status: 'aberto' },
                        { desc: 'Manuten√ß√£o Sistema', cat: 'Vari√°vel', venc: '2025-11-20', valor: 450, status: 'vencido' }
                      ].map((conta, i) => (
                        <tr key={i} className="border-b border-white/5 hover:bg-white/5 transition">
                          <td className="py-3 font-medium">{conta.desc}</td>
                          <td className="py-3 text-gray-400">{conta.cat}</td>
                          <td className="py-3 text-gray-400">{new Date(conta.venc).toLocaleDateString('pt-BR')}</td>
                          <td className="py-3 text-right font-bold">R$ {conta.valor.toFixed(2)}</td>
                          <td className="py-3 text-center">
                            <span className={`px-2 py-1 rounded text-[10px] font-bold ${
                              conta.status === 'vencido' ? 'bg-red-500/20 text-red-400' :
                              conta.status === 'vencendo' ? 'bg-yellow-500/20 text-yellow-400' :
                              'bg-blue-500/20 text-blue-400'
                            }`}>
                              {conta.status === 'vencido' ? 'VENCIDO' : conta.status === 'vencendo' ? 'VENCE HOJE' : 'ABERTO'}
                            </span>
                          </td>
                          <td className="py-3 text-center">
                            <button className="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-xs font-bold">
                              Pagar
                            </button>
                          </td>
                        </tr>
                      ))}
                    </tbody>
                  </table>
                </div>
              </>
            )}

            {/* CONTAS A RECEBER */}
            {financialTab === 'receivables' && (
              <>
                <h2 className="text-2xl font-bold mb-6">üí∞ Contas a Receber</h2>
                <div className="glass-panel p-6 rounded-xl mb-6">
                  <div className="grid grid-cols-3 gap-6 mb-6">
                    <div className="text-center p-4 bg-red-500/10 rounded-xl border border-red-500/30">
                      <div className="text-sm text-gray-400 mb-1">ATRASADAS</div>
                      <div className="text-3xl font-bold text-red-400">R$ 850,00</div>
                      <div className="text-xs text-gray-500 mt-1">4 clientes</div>
                    </div>
                    <div className="text-center p-4 bg-yellow-500/10 rounded-xl border border-yellow-500/30">
                      <div className="text-sm text-gray-400 mb-1">VENCENDO HOJE</div>
                      <div className="text-3xl font-bold text-yellow-400">R$ 2.340,00</div>
                      <div className="text-xs text-gray-500 mt-1">8 clientes</div>
                    </div>
                    <div className="text-center p-4 bg-green-500/10 rounded-xl border border-green-500/30">
                      <div className="text-sm text-gray-400 mb-1">A RECEBER</div>
                      <div className="text-3xl font-bold text-green-400">R$ 5.120,00</div>
                      <div className="text-xs text-gray-500 mt-1">15 clientes</div>
                    </div>
                  </div>
                </div>

                <div className="glass-panel p-6 rounded-xl">
                  <table className="w-full text-sm">
                    <thead className="border-b border-white/10 text-xs uppercase text-gray-400">
                      <tr>
                        <th className="py-3 text-left">Cliente</th>
                        <th className="py-3 text-left">Pedidos</th>
                        <th className="py-3 text-left">Vencimento</th>
                        <th className="py-3 text-right">Valor</th>
                        <th className="py-3 text-center">Status</th>
                        <th className="py-3 text-center">A√ß√µes</th>
                      </tr>
                    </thead>
                    <tbody>
                      {clients.slice(0, 8).map((client, i) => {
                        const clientOrders = orders.filter(o => o.clientId === client.id).length;
                        const valor = clientOrders * 45.5;
                        const status = i % 3 === 0 ? 'atrasado' : i % 3 === 1 ? 'vencendo' : 'aberto';
                        
                        return (
                          <tr key={client.id} className="border-b border-white/5 hover:bg-white/5 transition">
                            <td className="py-3 font-medium">{client.name}</td>
                            <td className="py-3 text-gray-400">{clientOrders} pedidos</td>
                            <td className="py-3 text-gray-400">22/11/2025</td>
                            <td className="py-3 text-right font-bold">R$ {valor.toFixed(2)}</td>
                            <td className="py-3 text-center">
                              <span className={`px-2 py-1 rounded text-[10px] font-bold ${
                                status === 'atrasado' ? 'bg-red-500/20 text-red-400' :
                                status === 'vencendo' ? 'bg-yellow-500/20 text-yellow-400' :
                                'bg-green-500/20 text-green-400'
                              }`}>
                                {status === 'atrasado' ? 'ATRASADO' : status === 'vencendo' ? 'VENCE HOJE' : 'ABERTO'}
                              </span>
                            </td>
                            <td className="py-3 text-center">
                              <button className="px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-xs font-bold">
                                Cobrar
                              </button>
                            </td>
                          </tr>
                        );
                      })}
                    </tbody>
                  </table>
                </div>
              </>
            )}
          </div>
        </div>
      )}

      {/* ==================== MODAIS ==================== */}
      
      {/* MODAL - DETALHES DO PEDIDO COM CHAT */}
      {openModal === 'order-detail' && selectedOrder && (
        <Dialog open={true} onOpenChange={handleCloseAll}>
          <DialogContent className="glass-modal max-w-7xl bg-[#0a0a0f] border border-white/10 p-0">
            <div className="grid grid-cols-3 h-[600px]">
              
              {/* COLUNA 1 - INFORMA√á√ïES DO PEDIDO */}
              <div className="border-r border-white/10 flex flex-col">
                <div className="p-6 border-b border-white/10">
                  <h2 className="text-2xl font-bold mb-1">Pedido #{selectedOrder.id.slice(0, 4)}</h2>
                  <p className="text-xs text-gray-400">Criado √†s {new Date(selectedOrder.createdAt).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</p>
                </div>

                {/* Cliente Final */}
                <div className="p-6 border-b border-white/10">
                  <div className="flex items-center justify-between mb-3">
                    <h3 className="text-sm font-bold text-gray-400 uppercase">üë§ Cliente Final</h3>
                    <button className="w-8 h-8 rounded-full bg-green-600 flex items-center justify-center hover:bg-green-500">
                      <MessageCircle size={16} />
                    </button>
                  </div>
                  <div className="font-bold text-lg mb-2">{selectedOrder.clientName}</div>
                  <div className="text-sm text-gray-400 flex items-center gap-2">
                    <MapPin size={14} /> {selectedOrder.entregaRua}, {selectedOrder.entregaNumero}, {selectedOrder.entregaBairro}
                  </div>
                  <div className="text-sm text-gray-400 mt-1">S√£o Mateus/ES</div>
                </div>

                {/* Financeiro */}
                <div className="p-6 border-b border-white/10">
                  <h3 className="text-sm font-bold text-gray-400 uppercase mb-3">üí∞ Financeiro</h3>
                  <div className="flex justify-between items-center mb-2">
                    <span className="text-sm text-gray-400">VALOR TOTAL</span>
                    <span className="text-2xl font-bold text-white">R$ {parseFloat(selectedOrder.valor).toFixed(2)}</span>
                  </div>
                  <div className="flex justify-between items-center text-sm">
                    <span className="text-gray-400">PAGAMENTO</span>
                    <span className="text-green-400 font-bold flex items-center gap-1">
                      üí≥ PIX (Pago)
                    </span>
                  </div>
                </div>

                {/* Hist√≥rico */}
                <div className="p-6 flex-1 overflow-y-auto">
                  <h3 className="text-sm font-bold text-gray-400 uppercase mb-3">üìã Hist√≥rico</h3>
                  <div className="space-y-3">
                    <div className="flex items-start gap-3">
                      <div className="w-2 h-2 rounded-full bg-green-500 mt-1.5"></div>
                      <div>
                        <div className="text-xs text-gray-500">{new Date(selectedOrder.createdAt).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</div>
                        <div className="text-sm">Motoboy {selectedOrder.motoboyName || 'Jo√£o'} aceitou</div>
                      </div>
                    </div>
                    <div className="flex items-start gap-3">
                      <div className="w-2 h-2 rounded-full bg-blue-500 mt-1.5"></div>
                      <div>
                        <div className="text-xs text-gray-500">{new Date(selectedOrder.createdAt).toLocaleTimeString('pt-BR', { hour: '2-digit', minute: '2-digit' })}</div>
                        <div className="text-sm">Pedido Recebido</div>
                      </div>
                    </div>
                  </div>
                </div>

                <button className="m-6 mt-0 py-3 bg-red-600 hover:bg-red-500 rounded-lg font-bold flex items-center justify-center gap-2">
                  üö´ Cancelar
                </button>
              </div>

              {/* COLUNA 2 - ESTABELECIMENTO + CHAT GERENTE */}
              <div className="border-r border-white/10 flex flex-col bg-[#141416]">
                <div className="p-4 border-b border-white/10 bg-blue-600/10">
                  <div className="flex items-center gap-3">
                    <div className="w-10 h-10 rounded-lg bg-blue-600 flex items-center justify-center text-white font-bold">
                      üè™
                    </div>
                    <div className="flex-1">
                      <h3 className="font-bold">üè™ Estabelecimento</h3>
                      <p className="text-xs text-gray-400">{selectedOrder.clientName}</p>
                    </div>
                    <span className="text-xs px-2 py-1 rounded-full bg-yellow-500/20 text-yellow-300 border border-yellow-500/30">
                      Preparando
                    </span>
                  </div>
                  <div className="flex gap-2 mt-3">
                    <button className="flex-1 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                      üìû Ligar
                    </button>
                    <button className="flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                      üí¨ WhatsApp
                    </button>
                  </div>
                </div>

                <div className="flex-1 flex flex-col bg-black/20">
                  <div className="p-2 text-xs text-center text-gray-500 border-b border-white/5">Chat Direto com Gerente</div>
                  <div className="flex-1 p-4 overflow-y-auto space-y-3">
                  <div className="flex gap-3">
                    <div className="w-8 h-8 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold text-xs flex-shrink-0">
                      BK
                    </div>
                    <div className="glass-panel p-3 rounded-xl rounded-tl-none max-w-[80%]">
                      <p className="text-sm">O pedido vai atrasar 5 minutos, chapa esquentando.</p>
                      <span className="text-[10px] text-gray-500 mt-1 block">11:45</span>
                    </div>
                  </div>
                  </div>
                </div>

                <div className="p-3 border-t border-white/10 bg-[#1a1a1a]">
                  <div className="flex gap-2">
                    <input 
                      type="text" 
                      placeholder="Falar com restaurante..." 
                      className="flex-1 px-4 py-2 glass-panel rounded-lg text-sm outline-none focus:ring-2 ring-blue-500"
                    />
                    <button className="w-10 h-10 bg-blue-600 hover:bg-blue-500 rounded-lg flex items-center justify-center">
                      ‚úàÔ∏è
                    </button>
                  </div>
                  <div className="mt-3">
                    <p className="text-xs font-bold text-red-400 mb-2">REPORTAR PROBLEMA</p>
                    <div className="grid grid-cols-2 gap-2">
                      <button className="py-2 px-3 bg-red-500/10 hover:bg-red-500/20 rounded-lg text-xs font-medium border border-red-500/30 flex items-center gap-1">
                        ‚è±Ô∏è Atraso Cozinha
                      </button>
                      <button className="py-2 px-3 bg-red-500/10 hover:bg-red-500/20 rounded-lg text-xs font-medium border border-red-500/30 flex items-center gap-1">
                        üçî Item em Falta
                      </button>
                    </div>
                  </div>
                </div>
              </div>

              {/* COLUNA 3 - LOG√çSTICA + CHAT MOTOBOY */}
              <div className="flex flex-col bg-[#1a1a1a]">
                <div className="p-4 border-b border-white/10 bg-purple-600/10">
                  <div className="flex items-center gap-3">
                    <div className="relative">
                      <div className="w-10 h-10 rounded-full bg-gradient-to-br from-purple-600 to-pink-600 flex items-center justify-center">
                        <img src="https://ui-avatars.com/api/?name=Joao+Silva&background=random" className="w-full h-full rounded-full" alt="Motoboy" />
                      </div>
                      <div className="absolute -bottom-1 -right-1 w-4 h-4 bg-green-500 rounded-full border-2 border-[#0a0a0f]"></div>
                    </div>
                    <div className="flex-1">
                      <h3 className="font-bold">üèçÔ∏è Log√≠stica</h3>
                      <p className="text-xs text-gray-400">{selectedOrder.motoboyName || 'Jo√£o Silva'}</p>
                      <p className="text-[10px] text-gray-500">Honda CG 160 ‚Ä¢ ABC-1234</p>
                    </div>
                    <span className="text-xs px-2 py-1 rounded-full bg-green-500/20 text-green-300 border border-green-500/30">
                      Em Rota
                    </span>
                  </div>
                  <div className="flex gap-2 mt-3">
                    <button className="flex-1 py-2 bg-purple-600 hover:bg-purple-500 rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                      üìû Ligar
                    </button>
                    <button className="flex-1 py-2 bg-green-600 hover:bg-green-500 rounded-lg text-sm font-bold flex items-center justify-center gap-1">
                      üí¨ WhatsApp
                    </button>
                  </div>
                </div>

                <div className="flex-1 flex flex-col bg-black/20">
                  <div className="p-2 text-xs text-center text-gray-500 border-b border-white/5">Chat Direto com Motoboy</div>
                  <div className="flex-1 p-4 overflow-y-auto space-y-3">
                  <div className="flex gap-3">
                    <div className="w-8 h-8 rounded-full bg-purple-600 flex-shrink-0">
                      <img src="https://ui-avatars.com/api/?name=Joao+Silva&background=random" className="w-full h-full rounded-full" alt="" />
                    </div>
                    <div className="glass-panel p-3 rounded-xl rounded-tl-none max-w-[80%]">
                      <p className="text-sm">Cheguei no BK, mas disseram que vai demorar.</p>
                      <span className="text-[10px] text-gray-500 mt-1 block">11:48</span>
                    </div>
                  </div>
                  
                  <div className="flex gap-3 justify-end">
                    <div className="bg-purple-600/30 p-3 rounded-xl rounded-tr-none max-w-[80%]">
                      <p className="text-sm">Ok, j√° falei com eles. Aguarde 5 min.</p>
                      <span className="text-[10px] text-gray-500 mt-1 block text-right">11:49</span>
                    </div>
                    <div className="w-8 h-8 rounded-full bg-blue-500 flex items-center justify-center text-white font-bold text-xs flex-shrink-0">
                      OP
                    </div>
                  </div>
                  </div>
                </div>

                <div className="p-3 border-t border-white/10 bg-[#1a1a1a]">
                  <div className="flex gap-2">
                    <input 
                      type="text" 
                      placeholder="Falar com motoboy..." 
                      className="flex-1 px-4 py-2 glass-panel rounded-lg text-sm outline-none focus:ring-2 ring-purple-500"
                    />
                    <button className="w-10 h-10 bg-purple-600 hover:bg-purple-500 rounded-lg flex items-center justify-center">
                      ‚úàÔ∏è
                    </button>
                  </div>
                  <div className="mt-3">
                    <p className="text-xs font-bold text-red-400 mb-2">REPORTAR PROBLEMA</p>
                    <div className="grid grid-cols-2 gap-2">
                      <button className="py-2 px-3 bg-red-500/10 hover:bg-red-500/20 rounded-lg text-xs font-medium border border-red-500/30 flex items-center gap-1">
                        üèçÔ∏è Pneu Furado
                      </button>
                      <button className="py-2 px-3 bg-red-500/10 hover:bg-red-500/20 rounded-lg text-xs font-medium border border-red-500/30 flex items-center gap-1">
                        üìç Endere√ßo Errado
                      </button>
                    </div>
                  </div>
                </div>
              </div>

            </div>
          </DialogContent>
        </Dialog>
      )}

      {/* MODAL - DETALHES DO MOTOBOY */}
      {openModal === 'driver-detail' && selectedDriver && (
        <div className="fixed inset-y-0 right-0 w-[450px] z-50 bg-[#1a1a1a] border-l border-white/10 shadow-2xl animate-slide-in flex flex-col">
          {/* Header Profile */}
          <div className="h-48 bg-gradient-to-b from-gray-800 to-[#1a1a1a] relative p-6 flex flex-col justify-end">
            <button onClick={handleCloseAll} className="absolute top-4 right-4 w-8 h-8 rounded-full bg-black/50 flex items-center justify-center text-white hover:bg-white/20 transition">
              <X size={18} />
            </button>
            <div className="flex items-end gap-4">
              <div className="relative">
                <div className="w-24 h-24 rounded-full bg-purple-600/30 border-4 border-[#1a1a1a] shadow-xl flex items-center justify-center">
                  <Bike className="w-12 h-12 text-purple-400" />
                </div>
                {selectedDriver.online && (
                  <div className="absolute bottom-1 right-1 w-5 h-5 bg-green-500 border-2 border-[#1a1a1a] rounded-full" title="Online"></div>
                )}
              </div>
              <div className="mb-2 flex-1">
                <h2 className="text-2xl font-bold text-white">{selectedDriver.name}</h2>
                <div className="text-gray-400 text-sm mb-2">{selectedDriver.phone}</div>
                <div className="flex gap-2">
                  <button className="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-xs font-bold flex items-center gap-1 transition">
                    <Phone size={12} /> WhatsApp
                  </button>
                  <button className="px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-xs font-bold flex items-center gap-1 transition">
                    <Phone size={12} /> Ligar
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Content */}
          <div className="p-6 flex-1 overflow-y-auto space-y-6">
            
            {/* Status Control */}
            <div className="bg-white/5 p-4 rounded-xl border border-white/10">
              <div className="flex justify-between items-center">
                <div>
                  <div className="text-sm font-bold text-white mb-1">Status do Motoboy</div>
                  <div className="text-xs text-gray-400">
                    {selectedDriver.status === 'ativo' ? 'Motoboy ativo no sistema' : 'Motoboy desativado'}
                  </div>
                </div>
                <button
                  onClick={() => {
                    if (confirm(`Deseja ${selectedDriver.status === 'ativo' ? 'DESATIVAR' : 'ATIVAR'} o motoboy ${selectedDriver.name}?\n\n${selectedDriver.status === 'ativo' ? 'Ele n√£o poder√° mais receber pedidos.' : 'Ele voltar√° a receber pedidos normalmente.'}`)) {
                      fetch(`/api/motoboys/${selectedDriver.id}`, {
                        method: 'PATCH',
                        headers: { 
                          'Content-Type': 'application/json',
                          'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ status: selectedDriver.status === 'ativo' ? 'inativo' : 'ativo' })
                      }).then(() => {
                        refetchMotoboys();
                        toast({ 
                          title: selectedDriver.status === 'ativo' ? 'Motoboy Desativado' : 'Motoboy Ativado',
                          description: `${selectedDriver.name} foi ${selectedDriver.status === 'ativo' ? 'desativado' : 'ativado'} com sucesso.`
                        });
                        handleCloseAll();
                      });
                    }
                  }}
                  className={`px-4 py-2 rounded-lg font-bold text-sm transition flex items-center gap-2 ${
                    selectedDriver.status === 'ativo' 
                      ? 'bg-red-500/20 text-red-400 border border-red-500/30 hover:bg-red-500/30' 
                      : 'bg-green-500/20 text-green-400 border border-green-500/30 hover:bg-green-500/30'
                  }`}
                >
                  {selectedDriver.status === 'ativo' ? (
                    <>
                      <X size={16} /> Desativar
                    </>
                  ) : (
                    <>
                      <User size={16} /> Ativar
                    </>
                  )}
                </button>
              </div>
            </div>

            {/* Daily Stats */}
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-white/5 p-4 rounded-xl border border-white/10">
                <div className="text-xs text-gray-400 uppercase mb-1">Entregas Hoje</div>
                <div className="text-2xl font-bold text-green-400">
                  {orders.filter(o => o.motoboyId === selectedDriver.id && new Date(o.createdAt).toDateString() === new Date().toDateString()).length}
                </div>
                <div className="text-[10px] text-gray-500">pedidos completados</div>
              </div>
              <div className="bg-white/5 p-4 rounded-xl border border-white/10">
                <div className="text-xs text-gray-400 uppercase mb-1">A Receber Hoje</div>
                <div className="text-2xl font-bold text-yellow-400">
                  R$ {orders
                    .filter(o => o.motoboyId === selectedDriver.id && new Date(o.createdAt).toDateString() === new Date().toDateString())
                    .reduce((sum, o) => sum + (parseFloat(o.valor) * 0.65), 0)
                    .toFixed(2)}
                </div>
                <div className="text-[10px] text-gray-500">estimativa</div>
              </div>
            </div>

            {/* Schedule Info */}
            <div className="bg-white/5 p-4 rounded-xl border border-white/10">
              <div className="flex justify-between items-center mb-2">
                <div className="text-xs text-gray-400 uppercase">Escala de Trabalho</div>
                {selectedDriver.online ? (
                  <span className="text-[10px] bg-green-500/20 text-green-400 px-2 py-0.5 rounded border border-green-500/30">EM TURNO</span>
                ) : (
                  <span className="text-[10px] bg-gray-500/20 text-gray-400 px-2 py-0.5 rounded border border-gray-500/30">OFFLINE</span>
                )}
              </div>
              <div className="flex justify-between items-center">
                <div>
                  <div className="text-sm font-bold text-white">18:00 - 23:00</div>
                  <div className="text-[10px] text-gray-500">Turno da Noite</div>
                </div>
                <div className="text-right">
                  <div className="text-[10px] text-gray-400">Dispon√≠vel</div>
                  <div className="text-sm font-bold text-blue-400">{selectedDriver.online ? 'Ativo' : 'Inativo'}</div>
                </div>
              </div>
            </div>

            {/* Active Orders */}
            <div>
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-bold text-gray-300 text-sm uppercase tracking-wider">Pedidos Ativos</h3>
              </div>
              <div className="space-y-3">
                {orders
                  .filter(o => o.motoboyId === selectedDriver.id && ['pending', 'in_progress', 'delivering'].includes(o.status))
                  .slice(0, 3)
                  .map((order, idx) => (
                    <div key={order.id} className="bg-blue-500/10 border border-blue-500/20 p-3 rounded-xl">
                      <div className="flex gap-3">
                        <div className="flex flex-col items-center gap-1">
                          <div className="w-10 h-10 rounded-full bg-blue-600 flex items-center justify-center text-white font-bold shadow-lg shadow-blue-900/50">
                            {idx + 1}
                          </div>
                        </div>
                        <div className="flex-1">
                          <div className="flex justify-between items-start">
                            <div>
                              <div className="font-bold text-white">{order.clientName}</div>
                              <div className="text-xs text-gray-400">#{order.id.slice(0, 4)} ‚Ä¢ {order.entregaRua}</div>
                            </div>
                            <div className="text-right">
                              <div className="text-xs text-green-400 font-bold">R$ {parseFloat(order.valor).toFixed(2)}</div>
                            </div>
                          </div>
                          <div className="mt-2 flex gap-2">
                            <button 
                              onClick={() => handleOpenModal('order-detail', order)}
                              className="px-2 py-1 bg-blue-500/20 hover:bg-blue-500/30 text-blue-300 text-xs rounded transition"
                            >
                              Ver Detalhes
                            </button>
                          </div>
                        </div>
                      </div>
                    </div>
                  ))}
                {orders.filter(o => o.motoboyId === selectedDriver.id && ['pending', 'in_progress', 'delivering'].includes(o.status)).length === 0 && (
                  <div className="text-center text-gray-500 text-sm py-8">Nenhum pedido ativo no momento</div>
                )}
              </div>
            </div>

            {/* Recent Deliveries */}
            <div>
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-bold text-gray-300 text-sm uppercase tracking-wider">Entregas Recentes</h3>
              </div>
              <div className="space-y-2">
                {orders
                  .filter(o => o.motoboyId === selectedDriver.id && o.status === 'completed')
                  .slice(0, 5)
                  .map(order => (
                    <div key={order.id} className="bg-white/5 p-3 rounded-xl border border-white/10 flex justify-between items-center">
                      <div>
                        <div className="text-sm font-bold text-white">#{order.id.slice(0, 4)}</div>
                        <div className="text-xs text-gray-400">{order.clientName}</div>
                      </div>
                      <div className="text-right">
                        <div className="text-sm text-green-400">R$ {parseFloat(order.valor).toFixed(2)}</div>
                        <div className="text-xs text-gray-500">{new Date(order.createdAt).toLocaleDateString('pt-BR')}</div>
                      </div>
                    </div>
                  ))}
                {orders.filter(o => o.motoboyId === selectedDriver.id && o.status === 'completed').length === 0 && (
                  <div className="text-center text-gray-500 text-sm py-4">Nenhuma entrega recente</div>
                )}
              </div>
            </div>
          </div>
        </div>
      )}

      {/* MODAL - DETALHES DO CLIENTE */}
      {openModal === 'client-detail' && selectedClient && (
        <div className="fixed inset-y-0 right-0 w-[450px] z-50 bg-[#1a1a1a] border-l border-white/10 shadow-2xl animate-slide-in flex flex-col">
          {/* Header Profile */}
          <div className="h-48 bg-gradient-to-b from-blue-800 to-[#1a1a1a] relative p-6 flex flex-col justify-end">
            <button onClick={handleCloseAll} className="absolute top-4 right-4 w-8 h-8 rounded-full bg-black/50 flex items-center justify-center text-white hover:bg-white/20 transition">
              <X size={18} />
            </button>
            <div className="flex items-end gap-4">
              <div className="relative">
                <div className="w-24 h-24 rounded-full bg-blue-600/30 border-4 border-[#1a1a1a] shadow-xl flex items-center justify-center">
                  <Store className="w-12 h-12 text-blue-400" />
                </div>
              </div>
              <div className="mb-2 flex-1">
                <h2 className="text-2xl font-bold text-white">{selectedClient.name}</h2>
                <div className="text-gray-400 text-sm mb-2">{selectedClient.phone}</div>
                <div className="flex gap-2">
                  <button className="px-3 py-1 bg-green-600 hover:bg-green-500 rounded text-xs font-bold flex items-center gap-1 transition">
                    <Phone size={12} /> WhatsApp
                  </button>
                  <button className="px-3 py-1 bg-blue-600 hover:bg-blue-500 rounded text-xs font-bold flex items-center gap-1 transition">
                    <Phone size={12} /> Ligar
                  </button>
                </div>
              </div>
            </div>
          </div>

          {/* Content */}
          <div className="p-6 flex-1 overflow-y-auto space-y-6">
            
            {/* Status Control */}
            <div className="bg-white/5 p-4 rounded-xl border border-white/10">
              <div className="flex justify-between items-center">
                <div>
                  <div className="text-sm font-bold text-white mb-1">Status do Cliente</div>
                  <div className="text-xs text-gray-400">
                    {(selectedClient as any).status === 'ativo' ? 'Cliente ativo no sistema' : 'Cliente desativado'}
                  </div>
                </div>
                <button
                  onClick={() => {
                    if (confirm(`Deseja ${(selectedClient as any).status === 'ativo' ? 'DESATIVAR' : 'ATIVAR'} o cliente ${selectedClient.name}?\n\n${(selectedClient as any).status === 'ativo' ? 'Ele n√£o poder√° mais fazer pedidos.' : 'Ele voltar√° a fazer pedidos normalmente.'}`)) {
                      fetch(`/api/clients/${selectedClient.id}`, {
                        method: 'PATCH',
                        headers: { 
                          'Content-Type': 'application/json',
                          'Authorization': `Bearer ${token}`
                        },
                        body: JSON.stringify({ status: (selectedClient as any).status === 'ativo' ? 'inativo' : 'ativo' })
                      }).then(() => {
                        queryClient.invalidateQueries({ queryKey: ['/api/clients'] });
                        toast({ 
                          title: (selectedClient as any).status === 'ativo' ? 'Cliente Desativado' : 'Cliente Ativado',
                          description: `${selectedClient.name} foi ${(selectedClient as any).status === 'ativo' ? 'desativado' : 'ativado'} com sucesso.`
                        });
                        handleCloseAll();
                      });
                    }
                  }}
                  className={`px-4 py-2 rounded-lg font-bold text-sm transition flex items-center gap-2 ${
                    (selectedClient as any).status === 'ativo' 
                      ? 'bg-red-500/20 text-red-400 border border-red-500/30 hover:bg-red-500/30' 
                      : 'bg-green-500/20 text-green-400 border border-green-500/30 hover:bg-green-500/30'
                  }`}
                >
                  {(selectedClient as any).status === 'ativo' ? (
                    <>
                      <X size={16} /> Desativar
                    </>
                  ) : (
                    <>
                      <Store size={16} /> Ativar
                    </>
                  )}
                </button>
              </div>
            </div>

            {/* Address */}
            <div className="bg-white/5 p-4 rounded-xl border border-white/10">
              <div className="text-xs text-gray-400 uppercase mb-2">Endere√ßo</div>
              <div className="text-sm text-white flex items-start gap-2">
                <MapPin size={16} className="mt-0.5 flex-shrink-0" />
                <span>{selectedClient.rua}, {selectedClient.numero} - {selectedClient.bairro}</span>
              </div>
            </div>

            {/* Stats */}
            <div className="grid grid-cols-2 gap-4">
              <div className="bg-white/5 p-4 rounded-xl border border-white/10">
                <div className="text-xs text-gray-400 uppercase mb-1">Total de Pedidos</div>
                <div className="text-2xl font-bold text-blue-400">
                  {orders.filter(o => o.clientId === selectedClient.id).length}
                </div>
                <div className="text-[10px] text-gray-500">pedidos realizados</div>
              </div>
              <div className="bg-white/5 p-4 rounded-xl border border-white/10">
                <div className="text-xs text-gray-400 uppercase mb-1">Receita Total</div>
                <div className="text-2xl font-bold text-green-400">
                  R$ {orders
                    .filter(o => o.clientId === selectedClient.id)
                    .reduce((sum, o) => sum + parseFloat(o.valor), 0)
                    .toFixed(2)}
                </div>
                <div className="text-[10px] text-gray-500">em taxas de entrega</div>
              </div>
            </div>

            {/* Recent Orders */}
            <div>
              <div className="flex justify-between items-center mb-3">
                <h3 className="font-bold text-gray-300 text-sm uppercase tracking-wider">Pedidos Recentes</h3>
              </div>
              <div className="space-y-3">
                {orders
                  .filter(o => o.clientId === selectedClient.id)
                  .slice(0, 5)
                  .map(order => (
                    <div 
                      key={order.id} 
                      onClick={() => handleOpenModal('order-detail', order)}
                      className="bg-white/5 p-3 rounded-xl border border-white/10 hover:border-blue-500/50 transition cursor-pointer"
                    >
                      <div className="flex justify-between items-start mb-2">
                        <div>
                          <div className="font-bold text-white">#{order.id.slice(0, 4)}</div>
                          <div className="text-xs text-gray-400">{new Date(order.createdAt).toLocaleString('pt-BR')}</div>
                        </div>
                        <div className="text-right">
                          <div className="text-sm font-bold text-green-400">R$ {parseFloat(order.valor).toFixed(2)}</div>
                          <div className={`text-[10px] px-2 py-0.5 rounded ${
                            order.status === 'completed' ? 'bg-green-500/20 text-green-400' :
                            order.status === 'delivering' ? 'bg-blue-500/20 text-blue-400' :
                            'bg-yellow-500/20 text-yellow-400'
                          }`}>
                            {order.status === 'completed' ? 'Conclu√≠do' :
                             order.status === 'delivering' ? 'Em Entrega' :
                             order.status === 'in_progress' ? 'Preparando' : 'Pendente'}
                          </div>
                        </div>
                      </div>
                      <div className="text-xs text-gray-500">
                        Entrega: {order.entregaRua}, {order.entregaNumero} - {order.entregaBairro}
                      </div>
                    </div>
                  ))}
                {orders.filter(o => o.clientId === selectedClient.id).length === 0 && (
                  <div className="text-center text-gray-500 text-sm py-8">Nenhum pedido registrado</div>
                )}
              </div>
            </div>

            {/* Payment Status */}
            <div className="bg-white/5 p-4 rounded-xl border border-white/10">
              <div className="text-xs text-gray-400 uppercase mb-2">Status Financeiro</div>
              <div className="flex justify-between items-center">
                <div>
                  <div className="text-sm font-bold text-white">A Receber</div>
                  <div className="text-xs text-gray-500">Taxas pendentes</div>
                </div>
                <div className="text-2xl font-bold text-green-400">
                  R$ {orders
                    .filter(o => o.clientId === selectedClient.id && o.status !== 'cancelled')
                    .reduce((sum, o) => sum + parseFloat(o.valor), 0)
                    .toFixed(2)}
                </div>
              </div>
            </div>
          </div>
        </div>
      )}

      {/* MODAL - CONFIGURA√á√ïES */}
      {openModal === 'settings' && (
        <Dialog open={true} onOpenChange={handleCloseAll}>
          <DialogContent className="glass-modal bg-[#1a1a1f] border border-white/10">
            <DialogHeader>
              <DialogTitle className="text-2xl font-bold">Configura√ß√µes</DialogTitle>
            </DialogHeader>
            <div className="space-y-4 mt-6">
              <div className="flex items-center justify-between p-4 glass-panel rounded-xl">
                <div>
                  <div className="font-medium">Modo Escuro</div>
                  <div className="text-xs text-gray-400 mt-1">{darkMode ? 'Tema escuro ativado' : 'Tema claro ativado'}</div>
                </div>
                <button 
                  onClick={() => setDarkMode(!darkMode)}
                  className={`w-14 h-7 rounded-full flex items-center px-1 transition-colors ${darkMode ? 'bg-blue-600' : 'bg-gray-400'}`}
                >
                  <div className={`w-5 h-5 bg-white rounded-full transition-transform ${darkMode ? 'translate-x-7' : 'translate-x-0'} shadow-lg`}></div>
                </button>
              </div>
              <div className="flex items-center justify-between p-4 glass-panel rounded-xl">
                <div>
                  <div className="font-medium">Notifica√ß√µes</div>
                  <div className="text-xs text-gray-400 mt-1">Alertas de novos pedidos</div>
                </div>
                <div className="w-12 h-6 bg-green-500 rounded-full flex items-center px-1">
                  <div className="w-4 h-4 bg-white rounded-full ml-auto"></div>
                </div>
              </div>
              <div className="flex items-center justify-between p-4 glass-panel rounded-xl">
                <div>
                  <div className="font-medium">Auto-aceitar</div>
                  <div className="text-xs text-gray-400 mt-1">Aceitar pedidos automaticamente</div>
                </div>
                <div className="w-12 h-6 bg-gray-500 rounded-full flex items-center px-1">
                  <div className="w-4 h-4 bg-white rounded-full"></div>
                </div>
              </div>
              <div className="flex items-center justify-between p-4 glass-panel rounded-xl">
                <div>
                  <div className="font-medium">Som de Notifica√ß√£o</div>
                  <div className="text-xs text-gray-400 mt-1">Tocar som ao receber pedido</div>
                </div>
                <div className="w-12 h-6 bg-green-500 rounded-full flex items-center px-1">
                  <div className="w-4 h-4 bg-white rounded-full ml-auto"></div>
                </div>
              </div>
            </div>
          </DialogContent>
        </Dialog>
      )}

      <ChatWidget 
        currentUserId={user?.id || ''} 
        currentUserName={user?.name || 'Central'} 
        currentUserRole={user?.role || 'central'} 
      />
      <OperationalInsights 
        clientSchedules={allClientSchedules}
        motoboySchedules={allMotoboySchedules}
        activeMotoboys={motoboys.filter(m => m.online)}
      />
    </div>
  );
}
